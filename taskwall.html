<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Agile Planning Board</title>
<link href="css/jquery-ui.css" rel="stylesheet" type="text/css"/>
<link href="css/html5wall.css" rel="stylesheet" type="text/css"/>
<link href="css/jquery.contextMenu.css" rel="stylesheet" type="text/css" />
<script src="js/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="js/jquery-ui.min.js" type="text/javascript"></script>
<script src="js/jquery.contextMenu.js" type="text/javascript"></script>
<script src="js/jquery.editable-1.3.3.min.js" type="text/javascript"></script>

<link rel="stylesheet" href="css/tipsy.css" type="text/css" />
<link rel="stylesheet" href="css/tipsy-docs.css" type="text/css" />
<script type="text/javascript" src="js/jquery.tipsy.js"></script>
</head>
<body>
	<div id="taskwalltopnav">
		<div id="showburndown" style="float:right;">
			Show burndown <input type="checkbox" value="unchecked" class="infopaneburn reportcheck" />
			Show cumulative flow <input type="checkbox" value="unchecked" class="infopanecum reportcheck" />
			Show test health <input type="checkbox" value="unchecked" class="infopanetest reportcheck" />
		</div>
		Add new column <span id="addnewcolumn" title="This adds a new swim lane column to the task wall, use a unique name per column."><img id="addcolicon" src="images/addicon.png"/></span>
		<div id="addnewcolsec" style="display:none;">
			<input id="coltitle" type="textbox" value="New column name"></input>
			<span id="addnewcol"><img src="images/tickicon.png" /></span>
		</div>	
	</div>
    <div id="board">
		<div id="infopanecum" class="infopane">
			{Cumulative flow}
		</div>
		<div id="infopaneburn" class="infopane">
			{Burndown}
		</div>
		<div id="infopanetest" class="infopane">
			{Test health}
		</div>
		<ul id="tabmenu"></ul>
	</div>

<!-- TEMPLATES FOR COLUMNS / CARDS -->
<!-- COLUMNS -->
<div id="coltodo" style="display:none;">
	<div class="title"><span class="hidecolumn"><img src="images/minusicon.png"/></span><span class="coltitle"></span> (W.I.P Limit <span class="colwip">3</span>) <span class="addcard"><img src="images/addicon.png"/></span></div>
</div>

<!-- CARDS -->
<div id="item0" class="card" draggable="true" style="display:none;">
    <div class="cardtitle">Learn HTML5</div>
		<div class="body">
			<div class="left">
				<h3>Remaining<h3>
					<h2><span class="hrsremaining"></span>hrs</h2>
					<h3>Owner<h3>
					<h3 class="grey owner"></h3>
					<h3>Priority</h3>
					<h3 class="grey priority"></h3>
					<h3>Cycle Time: <h3>
						<h3 class="grey"></h3>
					</div>
			<div class="right">
				<p class="cardstory"></p>
			</div>
		</div>
	<div class="footer">
		<div class="table">
		  <div class="row">
		  	<span class="cell" style="width:9%;"> hrs</span>
		    <span class="cell" style="width:35%;"><div id="progressbar" style="height:10px;"></div></span>
		    <span class="cell" style="width:10%;"> hrs</span>
		  </div>
		</div>
	</div>
</div>

<script type="text/javascript">
$('document').ready(init);
	function init(){
	//Creates a clone
		//WORK OUT HOW TO INCREMENT THE ITEM NUMBER - MAYBE VARIABLE
			var incCardNo;
			var incColNo = 1;
			var items;
			var columns = '#coltodo, #col1, #col2, #col3, #col4, #col5' //TODO: Check where this variable is used
			var columnswidth = 0;
			var addColWidth = 0;
			showColumns();
			calcBoardWidth();
			
			$(".infopane").draggable();
			
			// CALCULATES TASK BOARD WIDTH
			function calcBoardWidth(){
				$("div[id^='col']").each(function(n, i) {
					if (n == 0){	
						columnswidth = $(this).width();
						addColWidth = 10;
						incColNo = 1;
					} else {
						columnswidth += $(this).width();
						addColWidth += 10;
						incColNo = incColNo + 1;
						$("#board").width(columnswidth +addColWidth);
					}
				});
			}
			
			// CARD PROGRESS - EXPERIMENTAL
			$("#progressbar").progressbar({ value: 37 });
			// END OF EXPERIMENT
			
			$("div[id^='item']").each(function(n, i) {
				if (n == 0){
					items = "#" + this.id;
					incCardNo = 1;
				} else {
					items += ",#" + this.id;
					incCardNo = incCardNo+n;
				}
			});

			//Clones a column  
				$("#addnewcol").click(function() {
					cloneCol = $('#coltodo').clone(true).attr('id',"col" + incColNo).appendTo("#board");
				   	cloneCol.css("display","block");
					cloneCol.find('.coltitle').html($('#coltitle').val());		
					calcBoardWidth();
				});
	
			function showColumns() {
				$(".showcolumn").click(function(){
					 	var classes = $(this).attr('class').split(" ");
						$('.'+classes[0]).slideUp('fast', function() {
						    $('.'+classes[0]).remove();
							$('#'+classes[0]).show('slow');
						  });
				});
			}
			
			$(".hidecolumn").click(function(){
				var getTitle = $("#"+$(this).parent().parent().attr("id")).hide("slow");
				addmenuitem = $("#tabmenu").append('<li class=' +$(this).parent().parent().attr('id') + '><p>' + getTitle.find('.coltitle').html() + '</p></li>');
				$("."+$(this).parent().parent().attr('id')).addClass("showcolumn");
				showColumns();
			});

			$(".reportcheck").click(function(){
				var classes = $(this).attr('class').split(" ");
				$('#'+classes[0]).toggle('slow');
			});
			
			$(".addcard").click(function() {
				cloneCard("#"+$(this).parent().parent().attr("id"));
			});
			
			function cloneCard(area) {
				var card = $('#item0').clone(true).attr('id',"item" + incCardNo).appendTo(area);
				card.css("display","block");
			}
			
			//TOGGLE THE CREATE NEW COLUMN SECTION
			$("#addnewcolumn").click(function () {
      			$("#addnewcolsec").slideToggle("slow");
				var icon = $("#addcolicon").attr("src");
				if (icon == "images/addicon.png") {
					$("#addcolicon").attr("src", "images/crossicon.png");
				} else {
					$("#addcolicon").attr("src", "images/addicon.png");
				}
    		});
			
            $(items).bind('dragstart', function(event) {
				//alert(event.target.getAttribute('id'));
                event.originalEvent.dataTransfer.setData("text/plain", event.target.getAttribute('id'));
            });
            
   			// bind the dragover event on the board sections
            $(columns).bind('dragover', function(event) {
                event.preventDefault();
            });

			// bind the drop event on the board sections
   			$(columns).bind('drop', function(event) {
            	var notecard = event.originalEvent.dataTransfer.getData("text/plain");
            	event.target.appendChild(document.getElementById(notecard));
				// Turn off the default behaviour without this, FF will try and go to a URL with your id's name
            	event.preventDefault();
			});
        }

		$("#coltitle").click(function() {
			$(this).val("");
		});

		$(function() {
		    $('#addnewcolumn').tipsy({gravity: 'w',delayIn: 700,});
		  });
		
			//Inline card editable properties
			//function rerun(){
			//	$('.cardtitle').editable();
			//	$('.coltitle').editable();
			//	$('p.cardstory').editable({type:'textarea'});
			//	$('h3.priority').editable({
			//		type:'select', 
			//		options:{'Urgent':'urgent','High':'High','Medium':'Medium','Low':'Low'}
			//	});
			//	$('span.hrsremaining').editable();			
			//	$('h3.owner').editable({
			//		type:'select', 
			//		options:{'Urgent':'urgent','High':'High','Medium':'Medium','Low':'Low'}
			//	});
			//}
</script>
</body>
</html>